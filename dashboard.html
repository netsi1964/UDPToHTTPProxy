<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Flight monitor</title>
  <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
    }

    #map-canvas {
      height: 100vh;
      width: 100%;
    }
  </style>
</head>

<body>
  <div id="map-canvas"></div>
  <div class="container fluid">
    <div class="row">
      <h1>Flight monitor</h1>
    </div>
  </div>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="http://maps.google.com/maps/api/js"></script>
  <script>
    var flightPath = [],
      mapsFlightPath,
      $pos = $(".pos"),
      maxTrace = 10,
      f35,
      marker,
      lastPosition = null,
      drawFlightPath = false;

    function getFlightPosition(sURL, sPort) {
      sURL = (typeof sURL !== "undefined") ? sURL : "http://localhost";
      sPort = (typeof sPort !== "undefined") ? sPort : "8080";
      $.getJSON(sURL + ":" + sPort, function(data) {

        if (data.message.length > 0) {
          // lat,long,altitude
          var aTemp = data.message.split(",");

          var rawLatLng = {
            lat: parseFloat(aTemp[0]),
            lng: parseFloat(aTemp[1])
          };
          myLatLng = new google.maps.LatLng(rawLatLng);

          if (flightPath.length > maxTrace) {
            flightPath.shift();
          }
          flightPath.push(rawLatLng);


          map.panTo(myLatLng, animate = true);

          mapsFlightPath = new google.maps.Polyline({
            path: flightPath,
            geodesic: true,
            strokeColor: 'rgba(0,0,0,1)',
            strokeOpacity: 1,
            strokeWeight: 1
          });

          if (drawFlightPath) {
            mapsFlightPath.setMap(map);
          }

          if (marker) {
            marker.setMap(null)
          };

          marker = new google.maps.Marker({
            position: map.getCenter(),
            icon: f35,
            map: map,
            animation: (lastPosition===null) ? google.maps.Animation.DROP : null
          });

          var point1 = (lastPosition) ? lastPosition : initPosition;
          var point2 = lastPosition = map.getCenter();
          var heading = google.maps.geometry.spherical.computeHeading(point1, point2);


          marker.getIcon().rotation = heading;
          marker.setPosition(map.getCenter());
        }
      });

      setTimeout(getFlightPosition, 1000);
    }

    var lat = -34;
    var lng = 150;
    var map, initPosition;

    function initializeMap() {
      initPosition = new google.maps.LatLng(lat, lng);
      var mapOptions = {
        zoom: 10,
        center: initPosition,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      map = new google.maps.Map(document.getElementById('map-canvas'),
        mapOptions);

      f35 = {
        path: 'M21.593,52.299l-2.547,0l-1.129,-2.204c-0.655,2.489 -0.979,4.894 -1.284,8.01l-0.17,0l-9.527,-2.377l0,-3.123l5.534,-3.782l1.053,-2.428l-12.909,-3.282l0,-5.646c3.924,-2.659 7.849,-5.323 11.779,-8.036l1.39,-2.72l0.376,-8.863l0.735,-1.558l1.569,1.558l0.673,-1.558l1.505,-11.869c0.462,-1.361 1.033,-2.554 1.66,-3.689c0,0 1.235,2.328 1.698,3.689l1.504,11.869l0.673,1.558l1.569,-1.558l0.736,1.558l0.375,8.863l1.39,2.72c3.93,2.713 7.855,5.377 11.78,8.036l0,5.646l-12.91,3.282l1.053,2.428l5.534,3.782l0,3.123l-9.527,2.377l-0.17,0c-0.305,-3.116 -0.629,-5.521 -1.283,-8.01l-1.13,2.204Z',
        fillColor: '#d0d0d0',
        fillOpacity: 0.8,
        scale: 1,
        strokeColor: 'black',
        strokeWeight: 1,
        anchorPoint: new google.maps.Point(1500, -1300),
        rotation: 45
      }

      getFlightPosition();

    }
    google.maps.event.addDomListener(window, 'load', initializeMap);
  </script>
</body>

</html>
