<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Flight monitor</title>
  <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
    }

    #map-canvas {
      height: 100vh;
      width: 100%;
    }
  </style>
</head>

<body>
  <div id="map-canvas"></div>
  <div class="container fluid">
    <div class="row">
      <h1>Flight monitor</h1>
    </div>
    <div class="row">
      <div class="col-md-12">
        <h2>Current position</h2>
        <div class="pos"></div>
      </div>

    </div>

  </div>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="http://maps.google.com/maps/api/js"></script>
  <script>
    var flightPath = [],
      mapsFlightPath,
      $pos = $(".pos"),
      maxTrace = 10,
      f35,
      marker,
      lastPosition;

    function getFlightPosition(sURL, sPort) {
      sURL = (typeof sURL !== "undefined") ? sURL : "http://localhost";
      sPort = (typeof sPort !== "undefined") ? sPort : "8080";
      $.getJSON(sURL + ":" + sPort, function(data) {

        if (data.message.length > 0) {
          // lat,long,altitude
          var aTemp = data.message.split(",");

          var rawLatLng = {
            lat: parseFloat(aTemp[0]),
            lng: parseFloat(aTemp[1])
          };
          myLatLng = new google.maps.LatLng(rawLatLng);
          if (flightPath.length > maxTrace) {
            flightPath.shift();
          }
          flightPath.push(rawLatLng);

          map.panTo(myLatLng, animate = true);

          mapsFlightPath = new google.maps.Polyline({
            path: flightPath,
            geodesic: true,
            strokeColor: 'rgba(100,100,0,.5)',
            strokeOpacity: 1,
            strokeWeight: 9
          });
          mapsFlightPath.setMap(map);

          if (marker) {
            marker.setMap(null)
          };
          f35 = {
            path: 'M82.889,202.963l-9.988,0l-4.43,-8.641c-2.565,9.758 -3.838,19.193 -5.034,31.41l-0.667,0l-37.363,-9.32l0,-12.246l21.705,-14.835l4.128,-9.52l-50.626,-12.871l0,-22.141c15.39,-10.431 30.782,-20.879 46.194,-31.519l5.454,-10.666l1.471,-34.757l2.883,-6.11l6.154,6.11l2.638,-6.11l5.902,-46.546c1.814,-5.34 4.055,-10.016 6.514,-14.469c0,0 4.842,9.129 6.656,14.469l5.902,46.546l2.638,6.11l6.154,-6.11l2.883,6.11l1.472,34.757l5.453,10.666c15.412,10.64 30.804,21.088 46.195,31.519l0,22.141l-50.627,12.871l4.128,9.52l21.705,14.835l0,12.246l-37.363,9.32l-0.667,0c-1.196,-12.217 -2.469,-21.652 -5.034,-31.41l-4.43,8.641Z',
            fillColor: '#d0d0d0',
            fillOpacity: 0.8,
            scale: 1,
            strokeColor: 'black',
            strokeWeight: 1,
            anchorPoint: new google.maps.Point(1500, -1300),
            rotation: 45
          }

          marker = new google.maps.Marker({
            position: map.getCenter(),
            icon: f35,
            map: map
          });

          var point1 = (lastPosition) ? lastPosition : initPosition;
          var point2 = lastPosition = map.getCenter();
          var heading = google.maps.geometry.spherical.computeHeading(point1,point2);


          marker.getIcon().rotation = heading;
          marker.setPosition(map.getCenter());



          $pos.html("<code>lat:" + rawLatLng.lat + ",<br>lng:" + rawLatLng.lng + "</code>");
        }
      });

      setTimeout(getFlightPosition, 2000);
    }

    var lat = -34;
    var lng = 150;
    var map, initPosition;

    function initializeMap() {
      initPosition = new google.maps.LatLng(lat, lng);
      var mapOptions = {
        zoom: 10,
        center: initPosition,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      map = new google.maps.Map(document.getElementById('map-canvas'),
        mapOptions);






      getFlightPosition();

    }
    google.maps.event.addDomListener(window, 'load', initializeMap);
  </script>
</body>

</html>
